<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/x-icon" href="static/images/favicon.ico">
  <link rel="apple-touch-icon" href="static/images/apple-touch-icon.png">
  <link rel="manifest" href="static/images/site.webmanifest">
  <title>Deploying My Dog Breed Identifier with Streamlit on Hugging Face Spaces - MLOwl.ca</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" />
  <style>
    :root {
      --main-color: #0077cc;
      --font-body: 'Poppins', sans-serif;
      --max-width: 800px;
    }
    body {
      font-family: var(--font-body);
      margin: 0;
      padding: 0;
      background-color: #f5f7fa;
      color: #222;
    }
    .container {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 2rem 1rem;
    }
    header {
      margin-bottom: 2rem;
    }
    .featured-image {
      margin-bottom: 1.5rem;
      text-align: center;
    }
    .featured-image img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      margin-bottom: 0.3rem;
    }
    .image-credit {
      font-size: 0.85rem;
      color: #666;
      margin-top: 0;
    }
    h1 {
      font-size: 2.25rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    .byline {
      color: #666;
      font-size: 0.95rem;
      margin-bottom: 2rem;
    }
    p {
      font-size: 1rem;
      line-height: 1.75;
      margin-bottom: 1.5rem;
    }
    a {
      color: var(--main-color);
      text-decoration: none;
      font-weight: 600;
      border-bottom: 2px solid transparent;
      transition: border-color 0.3s;
    }
    a:hover {
      border-color: var(--main-color);
    }
    footer {
      margin-top: 3rem;
      font-size: 0.95rem;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.75rem;
      }
      .container {
        padding: 1.5rem 1rem;
      }
    }
    code:not([class]) {
      background-color: #f5f2f0;
      color: #c7254e;
      padding: 0.2em 0.4em;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="featured-image">
        <img src="static/images/‚ÄédogID_to_HF_with_streamlit_blog.png" alt="Dog Breed Identification Deployment" />
        <div class="image-credit">Image by Martin Bijloos</div>
      </div>
      <h1>Deploying My Dog Breed Identifier with Streamlit on Hugging Face Spaces</h1>
      <p class="byline">By Martin Bijloos, MLOwl.ca | August 24, 2025</p>
    </header>
    <main>
      <h2>üöÄ Why Deploy?</h2>
      <p>Training a deep learning model for dog breed identification was only half the journey. I wanted to make it accessible to others, so they could upload an image and see predictions in real time. That‚Äôs when I turned to <strong>Streamlit</strong> and <strong>Hugging Face Spaces</strong> for deployment.</p>

      <h2>üìù Step-by-Step Deployment Guide</h2>
      <ol>
        <li><strong>Prepare your trained model</strong> ‚Äì I saved my MobileNetV2 model as a <code>.keras</code> file.</li>
        <li><strong>Create a Hugging Face Space</strong> ‚Äì I created a new Space with: SDK = <code>streamlit</code>, License = MIT, and Visibility = Public.</li>
        <li><strong>Write a Streamlit app</strong> ‚Äì I created an <code>app.py</code> file that loads the model, preprocesses an uploaded image, and outputs predictions.</li>
        <li><strong>Set up a Hugging Face repository</strong> ‚Äì Initialize with <code>git</code>, push your files, and make sure your <code>requirements.txt</code> lists <code>streamlit</code>, <code>tensorflow</code>, and <code>Pillow</code>.</li>
        <li><strong>Add key files</strong> ‚Äì I added these key files to my Hugging Face repository: <code>app.py</code>, <code>requirements.txt</code>, <code>.streamlit/config.toml</code>, <code>README.md</code>, <code>assets/logo.png</code>.</li>
        <li><strong>Handle large model files</strong> ‚Äì Hugging Face requires <code>git-lfs</code> for files over 10 MB. I installed Git LFS, ran <code>git lfs track "*.keras"</code>, committed, and pushed again.</li>
        <li><strong>Create a model repository</strong> ‚Äì I created a model repository to make it more efficient for my Hugging Face Space to load the model</li>
        <li><strong>Debug deployment issues</strong> ‚Äì I fixed errors like missing dependencies, model path mismatches, and enforced light mode in Streamlit to keep the interface clean.</li>
        <li><strong>Test and share</strong> ‚Äì Once the app launched, I uploaded different dog photos to verify predictions, then shared the Hugging Face Spaces link.</li>
      </ol>

      <h2>üìú My <code>app.py</code> Code</h2>
      <pre><code class="language-python">import streamlit as st
import tensorflow as tf
import numpy as np
from PIL import Image

# Load model
@st.cache_resource
def load_model():
    return tf.keras.models.load_model("20250712-12391752338344-full-image-set-augmented-batch32-cache-prefetch-mobilenetv2-Adam.keras")

model = load_model()

# Define class names (120 breeds)
CLASS_NAMES = [...]  # replace with actual breed names list

st.set_page_config(page_title="Dog Breed Identifier", page_icon="üê∂", layout="centered")

st.title("üê∂ Dog Breed Identification App")
st.write("Upload a dog image and the model will predict its breed.")

uploaded_file = st.file_uploader("Choose an image...", type=["jpg", "jpeg", "png"])

if uploaded_file is not None:
    image = Image.open(uploaded_file).convert("RGB")
    st.image(image, caption="Uploaded Image", use_column_width=True)

    img = image.resize((224, 224))
    img_array = tf.keras.utils.img_to_array(img)
    img_array = tf.expand_dims(img_array, 0)

    predictions = model.predict(img_array)
    scores = tf.nn.softmax(predictions[0])
    predicted_class = CLASS_NAMES[np.argmax(scores)]
    confidence = 100 * np.max(scores)

    st.write(f"### Prediction: {predicted_class} ({confidence:.2f}% confidence)")</code></pre>

      <h2>üêõ Troubleshooting Highlights</h2>
      <ul>
        <li>‚ö†Ô∏è <strong>Model loading error:</strong> I learned to load my model by using the <code>custom_objects</code> method to enable the loading of a custom layer from TensorFlow Hub.</li>
        <li>‚ö†Ô∏è <strong>Large file push and run failures:</strong> Solved by pushing with <code>git-lfs</code> and running from a Hugging Face Model repository respectively.</li>
        <li>‚ö†Ô∏è <strong>Light/dark mode UI issues:</strong> Fixed by enforcing Streamlit‚Äôs light theme in <code>.streamlit/config.toml</code>.</li>
      </ul>

      <h2>üí° Key Takeaways</h2>
      <ul>
        <li>Streamlit + Hugging Face Spaces = quick, free, and user-friendly deployment.</li>
        <li>Git LFS is essential for large model files.</li>
        <li>Careful troubleshooting (paths, dependencies, configs) saves hours of frustration.</li>
      </ul>

      <p>Now my dog breed identifier is live, accessible, and easy to share with others. The deployment journey was as educational as the training itself!</p>
    </main>
    <footer>
      <a href="index.html">‚Üê Back to Home</a>
    </footer>
  </div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</body>
</html>